<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>four.gb</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  margin:0;
  font-family:system-ui,sans-serif;
  display:flex;
  height:100vh;
  background:#0f0f0f;
  color:white;
  overflow:hidden;
}

#sidebar {
  width:220px;
  background:#161616;
  padding:12px;
  display:flex;
  flex-direction:column;
  align-items:center;
  overflow-y:auto;
}

#sidebar img#logo {
  width:150px;
  margin:8px 0;
  border-radius:10px;
}

#sidebar img#profilePic {
  width:70px;
  height:70px;
  border-radius:50%;
  background:#444;
  cursor:pointer;
  object-fit:cover;
  display:block;
  margin:8px auto;
}

#profileRing {
  border:5px solid gold;
  border-radius:50%;
  display:none;
  width:80px;
  height:80px;
  position:absolute;
  top:8px;
  left:8px;
}

#sidebar button {
  display:flex;
  align-items:center;
  gap:8px;
  margin:4px 0;
  padding:10px;
  border:none;
  border-radius:8px;
  background:#2a2a2a;
  color:white;
  cursor:pointer;
  width:90%;
}

#sidebar button.active { background:#2e6cff; }
#sidebar button:hover { background:#444; }

#projectsSection button { width:100%; margin-top:4px; }
#projectsListSidebar { display:none; max-height:200px; overflow-y:auto; width:100%; margin-top:4px; }
#addProjectBtn { display:none; width:100%; margin-top:4px; }

#main { flex:1; display:flex; flex-direction:column; }

#topbar {
  height:48px;
  background:#121212;
  display:flex;
  align-items:center;
  justify-content:flex-end;
  gap:10px;
  padding:0 12px;
}

#topbar button {
  background:#2a2a2a;
  border:none;
  border-radius:8px;
  color:white;
  padding:6px 10px;
  cursor:pointer;
}

#messages {
  flex:1;
  padding:12px;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:8px;
}

.msg {
  max-width:80%;
  padding:10px 14px;
  border-radius:14px;
  word-wrap: break-word;
}

.user {
  align-self:flex-end;
  background:#2e6cff;
  border-bottom-right-radius:2px;
}

.ai {
  align-self:flex-start;
  background:#2a2a2a;
  border-bottom-left-radius:2px;
}

.msg img {
  max-width:100%;
  border-radius:12px;
  margin-top:6px;
}

.typing {
  font-size:28px;
  letter-spacing:6px;
  animation:blink 1.4s infinite;
}

@keyframes blink {0% {opacity:.2;} 20% {opacity:1;} 100% {opacity:.2;}}

#input-area {
  display:flex;
  gap:8px;
  padding:10px;
  background:#111;
}

#input {
  flex:1;
  padding:10px;
  border-radius:10px;
  border:none;
  background:#222;
  color:white;
}

#send {
  width:50px;
  height:50px;
  border-radius:50%;
  border:none;
  background:#2e6cff;
  color:white;
  font-size:20px;
  cursor:pointer;
  box-shadow:0 6px #1d4ed8;
  transition: all 0.1s ease-in-out;
}

#send:active {
  transform: translateY(4px);
  box-shadow:0 2px #1d4ed8;
}

.popup {
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#1e1e1e;
  padding:16px;
  border-radius:12px;
  display:none;
  width:280px;
  z-index:100;
  border: 2px solid #2e6cff;
}

.popup div {
  margin-bottom:10px;
  color:#fff;
  font-weight:bold;
}

.popup button {
  width:100%;
  margin-top:8px;
  background:#2e6cff;
  border:none;
  border-radius:6px;
  color:white;
  padding:8px;
  cursor:pointer;
}

#motherBtn {
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  width:150px;
  height:150px;
  border-radius:50%;
  background:red;
  display:none;
  cursor:pointer;
  z-index:200;
}

@media(max-width:768px){
  body {flex-direction: column;}
  #sidebar {width:100%; flex-direction:row; overflow-x:auto; padding:4px;}
  #main {flex:1;}
  #input-area {order:1; width:100%;}
}
</style>
</head>
<body>

<div id="sidebar">
  <img id="logo" src="eff00d44-ef75-4ac1-a032-37a28a472844.png" title="four.gb logo">
  <img id="profilePic" src="" title="Upload avatar" onclick="uploadAvatar()">
  <div id="profileRing"></div>

  <button id="chatBtn" class="active" onclick="showChat()">üí¨ Chat</button>
  <button id="imgBtn" onclick="showImages()">üñºÔ∏è Images</button>
  <button onclick="clearChat()">üßπ Clear</button>
  <button id="voiceBtn" onclick="toggleVoice()">üéôÔ∏è Voice ON</button>
  <button id="profileBtn" onclick="openProfile()">üë§ Profile</button>
  <button id="homeworkBtn" onclick="toggleHomework()">üìö Homework</button>

  <div id="projectsSection">
    <button id="projectsToggleBtn" onclick="toggleProjects()">üìÅ Projects ‚ñº</button>
    <div id="projectsListSidebar"></div>
    <button id="addProjectBtn" onclick="addProjectSidebar()">‚ûï Add Project</button>
  </div>
</div>

<div id="main">
  <div id="topbar">
    <button onclick="openShare()">üîó Share</button>
    <button onclick="openPeople()">üë• Add</button>
    <button onclick="startVoice()">üé§ Talk</button>
  </div>

  <div id="messages"></div>

  <div id="input-area">
    <input id="input" placeholder="Ask anything‚Ä¶" />
    <button id="send" onclick="send()">‚û§</button>
  </div>
</div>

<div id="sharePopup" class="popup">
  <div>Link copied!</div>
  <button onclick="closePopups()">OK</button>
</div>

<div id="peoplePopup" class="popup">
  <div>Add a new person</div>
  <input id="personInput" placeholder="Person name" style="width:100%; padding:6px; border-radius:6px; border:none; margin-bottom:8px; background:#222; color:white;">
  <button onclick="addPerson()">Add</button>
  <button onclick="closePopups()">Close</button>
</div>

<div id="profilePopup" class="popup">
  <div>Profile Info</div>
  <input id="usernameInput" placeholder="Username" />
  <input id="passwordInput" type="password" placeholder="Password" />
  <input id="ageInput" type="number" placeholder="Age 1-100" />
  <button onclick="login()">Login / Set</button>
  <button onclick="logout()">Logout</button>
  <button onclick="closePopups()">Close</button>
</div>

<div id="motherBtn" onclick="clickMother()">Mother</div>

<script>
let messages=document.getElementById("messages");
let input=document.getElementById("input");
let chatBtn=document.getElementById("chatBtn");
let imgBtn=document.getElementById("imgBtn");
let profilePic=document.getElementById("profilePic");
let profileRing=document.getElementById("profileRing");
let voiceBtn=document.getElementById("voiceBtn");
let homeworkBtn=document.getElementById("homeworkBtn");

let username=localStorage.getItem("username")||"";
let password=localStorage.getItem("password")||"";
let age=parseInt(localStorage.getItem("age"))||0;
let projects=JSON.parse(localStorage.getItem("projects")||"[]");
let people=JSON.parse(localStorage.getItem("people")||"[]");
let currentProjectIndex=null;
let voiceEnabled=true;
let clickCount=0;
let homeworkMode=false;
let imageHistory=[];

function addMessage(content,who){
  const div=document.createElement("div");
  div.className="msg "+who;
  if(content&&typeof content==="object"&&content.type==="image"){
    const img=document.createElement("img");
    img.src=content.src;
    div.appendChild(img);
    imageHistory.push(content.src);
  } else div.textContent=content;
  messages.appendChild(div);
  messages.scrollTop=messages.scrollHeight;
  if(currentProjectIndex!==null){
    projects[currentProjectIndex].chat.push({content,who});
    localStorage.setItem("projects",JSON.stringify(projects));
  }
}

function showTyping(){const d=document.createElement("div"); d.className="msg ai typing"; d.textContent="..."; messages.appendChild(d); return d;}
function clearChat(){messages.innerHTML="";}
function showChat(){chatBtn.classList.add("active"); imgBtn.classList.remove("active"); clearChat();}
function showImages(){imgBtn.classList.add("active"); chatBtn.classList.remove("active"); clearChat(); imageHistory.forEach(src=>addMessage({type:"image",src},"ai"));}
function toggleVoice(){voiceEnabled=!voiceEnabled; voiceBtn.textContent=`üéôÔ∏è Voice ${voiceEnabled?"ON":"OFF"`;}
function openShare(){navigator.clipboard.writeText(location.href);document.getElementById("sharePopup").style.display="block";}
function openPeople(){document.getElementById("peoplePopup").style.display="block";}
function openProfile(){document.getElementById("profilePopup").style.display="block";}
function closePopups(){document.querySelectorAll(".popup").forEach(p=>p.style.display="none");}

function uploadAvatar(){
  if(!username){alert("Login first!"); profilePic.style.display="none"; setTimeout(()=>{profilePic.style.display="block";},200);}
  else {const f=document.createElement("input"); f.type="file"; f.accept="image/*"; f.onchange=e=>{const file=e.target.files[0]; profilePic.src=URL.createObjectURL(file);}; f.click();}
}

function login(){
  let u=document.getElementById("usernameInput").value.trim();
  let p=document.getElementById("passwordInput").value.trim();
  let a=parseInt(document.getElementById("ageInput").value);
  if(a<1||a>100){alert("Age must be 1-100"); return;}
  username=u; password=p; age=a;
  localStorage.setItem("username",u);
  localStorage.setItem("password",p);
  localStorage.setItem("age",a);
  closePopups();
}
function logout(){username=""; password=""; age=0; localStorage.removeItem("username"); localStorage.removeItem("password"); localStorage.removeItem("age");}
function clickMother(){clickCount++;if(clickCount>=100){profileRing.style.display="block"; alert("Decorative ring unlocked!"); clickCount=0;}}

function toggleHomework(){homeworkMode=!homeworkMode; homeworkBtn.style.background=homeworkMode?"#2e6cff":"#2a2a2a"; alert(homeworkMode?"Homework mode activated!":"Homework mode deactivated!");}

/* Projects sidebar */
function toggleProjects(){const list=document.getElementById("projectsListSidebar"); const addBtn=document.getElementById("addProjectBtn"); const isVisible=list.style.display==="block"; list.style.display=isVisible?"none":"block"; addBtn.style.display=isVisible?"none":"block"; if(!isVisible) renderProjectsSidebar();}
function renderProjectsSidebar(){const list=document.getElementById("projectsListSidebar"); list.innerHTML=""; if(projects.length===0){const empty=document.createElement("div"); empty.textContent="No projects yet."; empty.style.padding="4px 8px"; empty.style.color="#aaa"; list.appendChild(empty); return;} projects.forEach((p,i)=>{const div=document.createElement("div"); div.textContent=p.name; div.style.padding="6px 8px"; div.style.background="#2a2a2a"; div.style.marginBottom="4px"; div.style.borderRadius="6px"; div.style.cursor="pointer"; div.onclick=()=>loadProject(i); list.appendChild(div);});}
function addProjectSidebar(){const name=prompt("Enter project name:"); if(!name) return; projects.push({name:name, chat:[]}); localStorage.setItem("projects",JSON.stringify(projects)); renderProjectsSidebar();}
function loadProject(index){currentProjectIndex=index; clearChat(); projects[index].chat.forEach(msg=>addMessage(msg.content,msg.who)); alert(`Loaded project: ${projects[index].name}`);}

/* People */
function addPerson(){const name=document.getElementById("personInput").value.trim(); if(!name){alert("Enter a name"); return;} people.push(name); localStorage.setItem("people",JSON.stringify(people)); alert(`Added ${name}`); document.getElementById("personInput").value="";}

/* Chat send & AI response */
async function aiResponse(text){
  let t=text.toLowerCase();
  if(t==="doodledog6767") return "Secret link: https://www.youtube.com/watch?v=dQw4w9WgXcQ";
  if(/^[0-9+\-*/().\s]+$/.test(text)){try{return String(Function("return "+text)());}catch{}}
  if(t==="hi"||t==="hello") return "Hey";
  if(homeworkMode&&(t.includes("word")||t.includes("math"))) return "Homework mode: Let's solve this together!";
  return homeworkMode?"Got it.":"Got it.";
}

async function send(){const text=input.value.trim(); if(!text) return; input.value=""; addMessage(text,"user"); const typing=showTyping(); setTimeout(async()=>{typing.remove(); const reply=await aiResponse(text); addMessage(reply,"ai"); if(voiceEnabled && typeof reply==="string"){let u=new SpeechSynthesisUtterance(reply); speechSynthesis.speak(u);}},1000);}
input.addEventListener("keydown",e=>{if(e.key==="Enter") send();});
function startVoice(){const rec=new (window.SpeechRecognition||webkitSpeechRecognition)(); rec.onresult=e=>{input.value=e.results[0][0].transcript; send();}; rec.start();}

/* Owner-only paste logo auto-resize */
document.addEventListener('paste', function(e){
  if(username!=="owner"||password!=="123456"||age!==10) return;
  const items=(e.clipboardData||e.originalEvent.clipboardData).items;
  for(let i in items){
    const item=items[i];
    if(item.kind==="file"){
      const blob=item.getAsFile();
      const reader=new FileReader();
      reader.onload=function(ev){
        const img=new Image();
        img.onload=function(){
          const logo=document.getElementById('logo');
          // Resize preserving aspect ratio
          if(img.width>img.height){
            logo.width=150;
            logo.height=150*(img.height/img.width);
          }else{
            logo.height=150;
            logo.width=150*(img.width/img.height);
          }
          logo.src=ev.target.result;
          alert('Logo updated by owner!');
        }
        img.src=ev.target.result;
      };
      reader.readAsDataURL(blob);
    }
  }
});

renderProjectsSidebar();
</script>
</body>
</html>

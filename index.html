<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>four.gb</title>
<style>
body {margin:0; font-family:system-ui,sans-serif; display:flex; height:100vh; background:#0f0f0f; color:white; overflow:hidden;}
#sidebar {width:220px; background:#161616; padding:12px; display:flex; flex-direction:column; align-items:center;}
#sidebar h2 {text-align:center;margin:8px 0;}
#sidebar button {display:flex; align-items:center; gap:8px; margin:4px 0; padding:10px; border:none; border-radius:8px; background:#2a2a2a; color:white; cursor:pointer; width:90%;}
#sidebar button.active {background:#2e6cff;}
#sidebar button:hover {background:#444;}
#main {flex:1; display:flex; flex-direction:column;}
#topbar {height:48px; background:#121212; display:flex; align-items:center; justify-content:flex-end; gap:10px; padding:0 12px;}
#topbar button {background:#2a2a2a; border:none; border-radius:8px; color:white; padding:6px 10px; cursor:pointer;}
#messages {flex:1; padding:12px; overflow-y:auto; display:flex; flex-direction:column; gap:8px;}
.msg {max-width:80%; padding:10px 14px; border-radius:14px;}
.user {align-self:flex-end; background:#2e6cff;}
.ai {align-self:flex-start; background:#2a2a2a;}
.msg img {max-width:100%; border-radius:12px; margin-top:6px;}
.typing {font-size:28px; letter-spacing:6px; animation:blink 1.4s infinite;}
@keyframes blink {0% {opacity:.2;} 20% {opacity:1;} 100% {opacity:.2;}}
#input-area {display:flex; gap:8px; padding:10px; background:#111;}
#input {flex:1; padding:10px; border-radius:10px; border:none; background:#222; color:white;}
#send {width:44px; height:44px; border-radius:50%; border:none; background:#2e6cff; color:white; font-size:18px; cursor:pointer;}
.popup {position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#1e1e1e; padding:16px; border-radius:12px; display:none; width:280px; z-index:100;}
.popup button {width:100%; margin-top:8px;}
#profilePic {width:70px; height:70px; border-radius:50%; background:#444; cursor:pointer; object-fit:cover; display:block; margin:8px auto;}
#motherBtn {position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); width:150px; height:150px; border-radius:50%; background:red; display:none; cursor:pointer; z-index:200;}
#profileRing {border:5px solid gold; border-radius:50%; display:none; width:80px; height:80px; position:absolute; top:8px; left:8px;}
</style>
</head>
<body>

<div id="sidebar">
<h2>four.gb</h2>
<img id="profilePic" src="" title="Upload avatar" onclick="uploadAvatar()">
<div id="profileRing"></div>
<button id="chatBtn" class="active" onclick="showChat()">üí¨ Chat</button>
<button id="imgBtn" onclick="showImages()">üñºÔ∏è Images</button>
<button onclick="clearChat()">üßπ Clear</button>
<button id="voiceBtn" onclick="toggleVoice()">üéôÔ∏è Voice ON</button>
<button onclick="openProfile()">üë§ Profile</button>
</div>

<div id="main">
<div id="topbar">
<button onclick="openShare()">üîó Share</button>
<button onclick="openPeople()">üë• Add</button>
<button onclick="startVoice()">üé§ Talk</button>
</div>

<div id="messages"></div>

<div id="input-area">
<input id="input" placeholder="Ask anything‚Ä¶" />
<button id="send" onclick="send()">‚û§</button>
</div>
</div>

<div id="sharePopup" class="popup">
<div>Link copied!</div>
<button onclick="closePopups()">OK</button>
</div>
<div id="peoplePopup" class="popup">
<div>Add people coming soon</div>
<button onclick="closePopups()">Close</button>
</div>
<div id="profilePopup" class="popup">
<div>Profile Info</div>
<input id="usernameInput" placeholder="Username" />
<input id="passwordInput" type="password" placeholder="Password" />
<input id="ageInput" type="number" placeholder="Age 10-100" />
<button onclick="login()">Login / Set</button>
<button onclick="logout()">Logout</button>
<button onclick="closePopups()">Close</button>
</div>

<div id="motherBtn" onclick="clickMother()">Mother</div>

<script>
let messages = document.getElementById("messages");
let input = document.getElementById("input");
let chatBtn = document.getElementById("chatBtn");
let imgBtn = document.getElementById("imgBtn");
let motherBtn = document.getElementById("motherBtn");
let profilePic = document.getElementById("profilePic");
let profileRing = document.getElementById("profileRing");
let voiceBtn = document.getElementById("voiceBtn");

let voiceEnabled = true;
let clickCount = 0;
let username = localStorage.getItem("username")||"";
let password = localStorage.getItem("password")||"";
let age = parseInt(localStorage.getItem("age"))||0;
let imageHistory = [];

function addMessage(content, who) {
  const div = document.createElement("div");
  div.className = "msg "+who;
  if(content && typeof content==="object" && content.type==="image"){
    const img=document.createElement("img");
    img.src=content.src;
    div.appendChild(img);
    imageHistory.push(content.src);
  } else div.textContent=content;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

function showTyping() {
  const d=document.createElement("div");
  d.className="msg ai typing";
  d.textContent="...";
  messages.appendChild(d);
  return d;
}

function clearChat(){messages.innerHTML="";}
function showChat(){chatBtn.classList.add("active");imgBtn.classList.remove("active");clearChat();}
function showImages(){imgBtn.classList.add("active");chatBtn.classList.remove("active");clearChat();imageHistory.forEach(src=>addMessage({type:"image",src},"ai"));}
function toggleVoice(){
  voiceEnabled = !voiceEnabled;
  voiceBtn.textContent=`üéôÔ∏è Voice ${voiceEnabled?"ON":"OFF"}`;
}
function openShare(){navigator.clipboard.writeText(location.href);document.getElementById("sharePopup").style.display="block";}
function openPeople(){document.getElementById("peoplePopup").style.display="block";}
function openProfile(){document.getElementById("profilePopup").style.display="block";}
function closePopups(){document.querySelectorAll(".popup").forEach(p=>p.style.display="none");}
function uploadAvatar(){
  if(!username){alert("Login first!");profilePic.style.display="none";setTimeout(()=>{profilePic.style.display="block";},200);}
  else {const f=document.createElement("input");f.type="file";f.accept="image/*";f.onchange=e=>{const file=e.target.files[0];profilePic.src=URL.createObjectURL(file);};f.click();}
}

function login(){
  let u = document.getElementById("usernameInput").value.trim();
  let p = document.getElementById("passwordInput").value.trim();
  let a = parseInt(document.getElementById("ageInput").value);
  if(a<10||a>100){ alert("Age must be 10-100"); return; }
  username = u; password = p; age = a;
  localStorage.setItem("username", u);
  localStorage.setItem("password", p);
  localStorage.setItem("age", a);
  closePopups();
}

function logout(){username="";password="";age=0;localStorage.removeItem("username");localStorage.removeItem("password");localStorage.removeItem("age");}

function clickMother(){clickCount++;if(clickCount>=100){profileRing.style.display="block";alert("Decorative ring unlocked!");clickCount=0;}}

/* Smart AI + Math + Image */
async function aiResponse(text){
  let t = text.toLowerCase().trim();

  // Math: replace x, √∑, remove =
  let mathText = t.replace(/x/gi,"*").replace(/√∑/g,"/").replace(/=/g,"");
  let mathMatch = mathText.match(/[\d\+\-\*\/\.\(\) ]+/);
  if(mathMatch){
    try{return String(Function("return "+mathMatch[0])());}catch{}
  }

  // slang / chat
  let slang={"gtg":"Alright, later.","brb":"Okay.","lol":"Yeah","idk":"That‚Äôs fine.","fr":"For real.","hi":"Hey","hello":"Hey"};
  if(slang[t]) return slang[t];

  // image requests
  let imgWords=["draw","create","image","picture","make"];
  if(imgWords.some(w=>t.startsWith(w))){
    let subject=t.replace(/^(draw|create|image|picture|make)\s+/,"").replace(/^of\s+/,"").trim();
    if(!subject) subject="art";
    try{
      const res = await fetch('http://localhost:3000/generate-image',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({prompt: subject})
      });
      const data = await res.json();
      const url = data?.data?.[0]?.url || data?.url;
      if(url) return {type:"image", src:url};
      return "‚ö†Ô∏è No image returned";
    }catch{ return "‚ö†Ô∏è Image server offline"; }
  }

  return "Got it.";
}

async function send(){
  const text = input.value.trim();
  if(!text) return;
  input.value = "";
  addMessage(text,"user");
  const typing = showTyping();
  const reply = await aiResponse(text);
  typing.remove();
  if(reply && typeof reply === "object" && reply.type === "image"){
    addMessage(reply,"ai");
  } else {
    addMessage(reply,"ai");
    if(voiceEnabled && typeof reply==="string"){
      let u=new SpeechSynthesisUtterance(reply);
      speechSynthesis.speak(u);
    }
  }
}

input.addEventListener("keydown",e=>{if(e.key==="Enter") send();});

/* Voice input */
function startVoice(){
  const rec=new (window.SpeechRecognition||webkitSpeechRecognition)();
  rec.onresult=e=>{input.value=e.results[0][0].transcript; send();}
  rec.start();
}
</script>
</body>
</html>

<script>
async function aiResponse(text){
  let t = text.toLowerCase().trim();

  // Math: x=*, ÷=/, remove =
  let mathText = t.replace(/x/gi,"*").replace(/÷/g,"/").replace(/=/g,"");
  
  // Try math
  try {
    if(/^[0-9+\-*/().\s]+$/.test(mathText)){
      let result;
      if(mathText.includes('.') || mathText.includes('e')){
        result = Function("return "+mathText)();
      } else {
        let bigText = mathText.replace(/\d+/g,m=>BigInt(m));
        result = Function("return "+bigText)();
      }
      return String(result);
    }
  } catch{}

  // Slang / Chat
  let slang={"gtg":"Alright, later.","brb":"Okay.","lol":"Yeah","idk":"That’s fine.","fr":"For real.","hi":"Hey","hello":"Hey"};
  if(slang[t]) return slang[t];

  // Big number comparisons
  let compareMatch = t.match(/(\d+(?:\.\d+)?(?:e[+-]?\d+)?).*?(bigger|more|larger|greater).*?(\d+(?:\.\d+)?(?:e[+-]?\d+)?)/);
  if(compareMatch){
    await new Promise(r=>setTimeout(r, 3000)); // 3-second thinking
    let n1 = Number(compareMatch[1]);
    let n2 = Number(compareMatch[3]);
    if(isNaN(n1)||isNaN(n2)) return "Unidentified numbers";
    return n1>n2 ? `${n1} is bigger than ${n2}` : `${n2} is bigger than ${n1}`;
  }

  // Image requests
  let imgWords=["draw","create","image","picture","make"];
  if(imgWords.some(w=>t.startsWith(w))){
    let subject=t.replace(/^(draw|create|image|picture|make)\s+/,"").replace(/^of\s+/,"").trim();
    if(!subject) subject="art";
    try{
      const res = await fetch('http://localhost:3000/generate-image',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({prompt: subject})
      });
      const data = await res.json();
      const url = data?.data?.[0]?.url || data?.url;
      if(url) return {type:"image", src:url};
      return "⚠️ No image returned";
    }catch{ return "⚠️ Image server offline"; }
  }

  // Default response with 3-second thinking
  await new Promise(r=>setTimeout(r, 3000));
  return "Got it.";
}
</script>

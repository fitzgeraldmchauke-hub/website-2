<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>four.gb</title>

<style>
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:#0f0f0f;
  color:white;
  height:100vh;
  display:flex;
  overflow:hidden;
}

/* SIDEBAR */
#sidebar{
  width:220px;
  background:#161616;
  padding:12px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:6px;
}
#sidebar h2{margin:6px 0;}
#sidebar button{
  width:100%;
  padding:10px;
  border:none;
  border-radius:8px;
  background:#2a2a2a;
  color:white;
  cursor:pointer;
}
#sidebar button:hover{background:#444}
#sidebar button.active{background:#2e6cff}

/* AVATAR */
#profilePic{
  width:70px;
  height:70px;
  border-radius:50%;
  background:#333;
  object-fit:cover;
  cursor:pointer;
  margin-bottom:6px;
}

/* MAIN */
#main{
  flex:1;
  display:flex;
  flex-direction:column;
}

/* TOP BAR */
#topbar{
  height:48px;
  background:#121212;
  display:flex;
  align-items:center;
  gap:10px;
  padding:0 12px;
}
#topbar button{
  background:#2a2a2a;
  border:none;
  border-radius:8px;
  color:white;
  padding:6px 10px;
  cursor:pointer;
}

/* CHAT */
#messages{
  flex:1;
  padding:12px;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:8px;
}
.msg{
  max-width:80%;
  padding:10px 14px;
  border-radius:14px;
}
.user{align-self:flex-end;background:#2e6cff;}
.ai{align-self:flex-start;background:#2a2a2a;}

#input-area{
  display:flex;
  gap:8px;
  padding:10px;
  background:#111;
}
#input{
  flex:1;
  padding:10px;
  border-radius:10px;
  border:none;
  background:#222;
  color:white;
}
#send{
  width:44px;
  height:44px;
  border-radius:50%;
  border:none;
  background:#2e6cff;
  color:white;
  font-size:18px;
  cursor:pointer;
}

/* POPUPS */
.popup{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#1e1e1e;
  padding:16px;
  border-radius:12px;
  display:none;
  z-index:100;
  width:260px;
}
.popup input,.popup button{
  width:100%;
  margin-top:8px;
}
</style>
</head>

<body>

<!-- SIDEBAR -->
<div id="sidebar">
  <h2>four.gb</h2>
  <img id="profilePic" title="Upload avatar">

  <button id="chatBtn" class="active" onclick="showChat()">Chat</button>
  <button id="imgBtn" onclick="showImages()">Images</button>
  <button onclick="clearChat()">Clear</button>

  <button onclick="newProject()">New Project</button>
  <button onclick="pickProject()">Projects</button>

  <button onclick="openProfile()">Profile</button>
</div>

<!-- MAIN -->
<div id="main">
  <div id="topbar">
    <button onclick="addUser()">Add</button>
    <button onclick="share()">Share</button>
    <button onclick="talk()">Talk</button>
  </div>

  <div id="messages"></div>

  <div id="input-area">
    <input id="input" placeholder="Ask anything…" />
    <button id="send" onclick="send()">➤</button>
  </div>
</div>

<!-- PROFILE POPUP -->
<div id="profilePopup" class="popup">
  <input id="usernameInput" placeholder="Username">
  <button onclick="login()">Login / Save</button>
  <button onclick="logout()">Logout</button>
  <button onclick="closePopups()">Close</button>
</div>

<script>
/* ================= STATE ================= */
let projects = JSON.parse(localStorage.getItem("projects")||"{}");
let currentProject = localStorage.getItem("currentProject") || null;

let username = localStorage.getItem("username") || "";
let avatar = localStorage.getItem("avatar") || "";

const messages = document.getElementById("messages");
const input = document.getElementById("input");
const profilePic = document.getElementById("profilePic");
const chatBtn = document.getElementById("chatBtn");
const imgBtn = document.getElementById("imgBtn");

/* ================= INIT ================= */
if(!currentProject){
  newProject();
}else{
  openProject(currentProject);
}
if(avatar) profilePic.src = avatar;

/* ================= SIDEBAR MODES ================= */
function showChat(){
  chatBtn.classList.add("active");
  imgBtn.classList.remove("active");
  openProject(currentProject);
}
function showImages(){
  chatBtn.classList.remove("active");
  imgBtn.classList.add("active");
  messages.innerHTML="";
}

/* ================= PROJECTS ================= */
function saveProjects(){
  localStorage.setItem("projects",JSON.stringify(projects));
  localStorage.setItem("currentProject",currentProject);
}

function newProject(){
  const name = prompt("Project name?");
  if(!name || projects[name]) return;
  projects[name]=[];
  openProject(name);
}

function pickProject(){
  const list = Object.keys(projects);
  if(!list.length) return alert("No projects");
  const choice = prompt("Projects:\n"+list.join("\n"));
  if(projects[choice]) openProject(choice);
}

function openProject(name){
  currentProject=name;
  messages.innerHTML="";
  projects[name].forEach(m=>renderMessage(m.text,m.who));
  saveProjects();
}

function clearChat(){
  projects[currentProject]=[];
  messages.innerHTML="";
  saveProjects();
}

/* ================= CHAT ================= */
function renderMessage(text,who){
  const d=document.createElement("div");
  d.className="msg "+who;
  d.textContent=text;
  messages.appendChild(d);
  messages.scrollTop=messages.scrollHeight;
}

function addMessage(text,who){
  const last=projects[currentProject].at(-1);
  if(last && last.text===text && last.who===who) return;
  projects[currentProject].push({text,who});
  renderMessage(text,who);
  saveProjects();
}

/* ================= AI ================= */
function parseBig(str){
  const m={thousand:1e3,million:1e6,billion:1e9,trillion:1e12,quadrillion:1e15,quintillion:1e18,sextillion:1e21};
  let r=str.match(/([\d.]+)\s*(\w+)?/);
  if(!r) return NaN;
  let n=parseFloat(r[1]);
  if(m[r[2]]) n*=m[r[2]];
  return n;
}

function aiReply(t){
  let s=t.toLowerCase();

  if(s==="doodledog6767")
    return "https://www.youtube.com/watch?v=dQw4w9WgXcQ";

  let math=s.replace(/(\d)\s*x\s*(\d)/g,"$1*$2");
  if(/^[\d+\-*/().\s]+$/.test(math)){
    try{return String(Function("return "+math)());}catch{}
  }

  if(s.includes("bigger than")){
    let p=s.split("bigger than");
    let a=parseBig(p[0]),b=parseBig(p[1]);
    if(!isNaN(a)&&!isNaN(b))
      return a>b?"First is bigger":b>a?"Second is bigger":"Equal";
  }

  return "I understand.";
}

/* ================= SEND ================= */
function send(){
  if(!currentProject) return;
  const text=input.value.trim();
  if(!text) return;
  input.value="";
  addMessage(text,"user");
  setTimeout(()=>addMessage(aiReply(text),"ai"),3000);
}

input.addEventListener("keydown",e=>{
  if(e.key==="Enter"){e.preventDefault();send();}
});

/* ================= PROFILE ================= */
profilePic.onclick=uploadAvatar;

function uploadAvatar(){
  const f=document.createElement("input");
  f.type="file";f.accept="image/*";
  f.onchange=e=>{
    const r=new FileReader();
    r.onload=()=>{
      profilePic.src=r.result;
      if(username){
        localStorage.setItem("avatar",r.result);
      }else{
        setTimeout(()=>{
          profilePic.style.transition="1.5s";
          profilePic.style.opacity="0";
          profilePic.style.transform="scale(.2)";
        },1000);
        setTimeout(()=>{
          profilePic.src="";
          profilePic.style.opacity="1";
          profilePic.style.transform="";
        },3000);
      }
    };
    r.readAsDataURL(e.target.files[0]);
  };
  f.click();
}

function openProfile(){
  document.getElementById("profilePopup").style.display="block";
}
function closePopups(){
  document.querySelectorAll(".popup").forEach(p=>p.style.display="none");
}
function login(){
  username=document.getElementById("usernameInput").value.trim();
  if(!username) return;
  localStorage.setItem("username",username);
  closePopups();
}
function logout(){
  localStorage.clear();
  location.reload();
}

/* ================= TOP BAR ================= */
function addUser(){
  const u=prompt("Enter username:");
  if(u) alert("User '"+u+"' found (demo)");
}
function share(){
  navigator.clipboard.writeText(location.href);
  alert("Link copied");
}
function talk(){
  alert("Voice coming soon");
}
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>four.gb</title>

<style>
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:#0f0f0f;
  color:white;
  height:100vh;
  display:flex;
  overflow:hidden;
}

/* SIDEBAR */
#sidebar{
  width:220px;
  background:#161616;
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:6px;
}
#sidebar h2{margin:6px 0;text-align:center}
#sidebar button{
  padding:10px;
  border:none;
  border-radius:8px;
  background:#2a2a2a;
  color:white;
  cursor:pointer;
}
#sidebar button:hover{background:#444}
#sidebar button.active{background:#2e6cff}
#projectList{flex:1;overflow-y:auto}

/* AVATAR */
#profileWrap{position:relative;text-align:center}
#profilePic{
  width:70px;height:70px;border-radius:50%;
  background:#333;object-fit:cover;cursor:pointer
}
#ring{
  position:absolute;top:-6px;left:-6px;
  width:82px;height:82px;border-radius:50%;
  border:4px solid gold;display:none
}

/* MAIN */
#main{flex:1;display:flex;flex-direction:column}

/* TOP BAR */
#topbar{
  height:48px;background:#121212;
  display:flex;justify-content:flex-end;
  align-items:center;gap:10px;padding:0 12px
}
#topbar button{
  background:#2a2a2a;border:none;border-radius:8px;
  color:white;padding:6px 10px;cursor:pointer
}

/* CHAT */
#messages{
  flex:1;padding:12px;overflow-y:auto;
  display:flex;flex-direction:column;gap:8px
}
.msg{max-width:80%;padding:10px 14px;border-radius:14px}
.user{align-self:flex-end;background:#2e6cff}
.ai{align-self:flex-start;background:#2a2a2a}
.typing{letter-spacing:6px;animation:blink 1.4s infinite}
@keyframes blink{0%{opacity:.2}20%{opacity:1}100%{opacity:.2}}

#input-area{display:flex;gap:8px;padding:10px;background:#111}
#input{
  flex:1;padding:10px;border-radius:10px;
  border:none;background:#222;color:white
}
#send{
  width:44px;height:44px;border-radius:50%;
  border:none;background:#2e6cff;color:white;
  font-size:18px;cursor:pointer
}

/* POPUPS */
.popup{
  position:fixed;top:50%;left:50%;
  transform:translate(-50%,-50%);
  background:#1e1e1e;padding:16px;
  border-radius:12px;display:none;z-index:100;
  width:260px
}
.popup input,.popup button{width:100%;margin-top:8px}
</style>
</head>

<body>

<div id="sidebar">
  <h2>four.gb</h2>

  <div id="profileWrap">
    <img id="profilePic">
    <div id="ring"></div>
  </div>

  <button onclick="showChat()">Chat</button>
  <button onclick="showImages()">Images</button>
  <button onclick="clearChat()">Clear</button>
  <button onclick="toggleVoice()">Voice</button>
  <button onclick="openProfile()">Profile</button>

  <div id="projectList"></div>
  <button onclick="newProject()">Projects</button>
</div>

<div id="main">
  <div id="topbar">
    <button onclick="openAdd()">Add</button>
    <button onclick="openShare()">Share</button>
    <button onclick="toggleVoice()">Voice</button>
  </div>

  <div id="messages"></div>

  <div id="input-area">
    <input id="input" placeholder="Ask anything">
    <button id="send" onclick="send()">></button>
  </div>
</div>

<!-- POPUPS -->
<div id="addPopup" class="popup">
  <input id="addUserInput" placeholder="Username">
  <button onclick="confirmAdd()">Add</button>
  <button onclick="closePopups()">Close</button>
</div>

<div id="sharePopup" class="popup">
  <div>Link copied</div>
  <button onclick="closePopups()">OK</button>
</div>

<div id="profilePopup" class="popup">
  <input id="usernameInput" placeholder="Username">
  <button onclick="login()">Save</button>
  <button onclick="logout()">Logout</button>
  <button onclick="closePopups()">Close</button>
</div>

<script>
/* STATE */
let projects = JSON.parse(localStorage.getItem("projects")||"{}");
let currentProject = localStorage.getItem("currentProject")||null;
let images = JSON.parse(localStorage.getItem("images")||"[]");
let username = localStorage.getItem("username")||"";
let avatar = localStorage.getItem("avatar")||"";
let voiceOn=false,recognition=null;
let motherClicks=0;

/* INIT */
if(!currentProject){createProject("Main")}
renderProjects();
openProject(currentProject);
if(avatar)profilePic.src=avatar;

/* PROJECTS */
function createProject(name){
  projects[name]=[];
  currentProject=name;
  save();
}
function newProject(){
  const n=prompt("Project name");
  if(!n||projects[n])return;
  createProject(n);renderProjects();openProject(n);
}
function renderProjects(){
  projectList.innerHTML="";
  Object.keys(projects).forEach(p=>{
    const b=document.createElement("button");
    b.textContent=p;
    if(p===currentProject)b.classList.add("active");
    b.onclick=()=>openProject(p);
    projectList.appendChild(b);
  });
}
function openProject(p){
  currentProject=p;messages.innerHTML="";
  projects[p].forEach(m=>render(m.text,m.who));
  renderProjects();save();
}
function save(){
  localStorage.setItem("projects",JSON.stringify(projects));
  localStorage.setItem("currentProject",currentProject);
  localStorage.setItem("images",JSON.stringify(images));
}

/* CHAT */
function render(t,w){
  const d=document.createElement("div");
  d.className="msg "+w;
  d.textContent=t;
  messages.appendChild(d);
}
function typing(){
  const d=document.createElement("div");
  d.className="msg ai typing";
  d.textContent="...";
  messages.appendChild(d);
  return d;
}
function send(){
  const t=input.value.trim();if(!t)return;
  input.value="";
  add(t,"user");
  const dots=typing();
  setTimeout(()=>{
    dots.remove();
    add(ai(t),"ai");
  },3000);
}
input.onkeydown=e=>{if(e.key==="Enter")send()};
function add(t,w){
  projects[currentProject].push({text:t,who:w});
  render(t,w);save();
}

/* AI */
function ai(t){
  const s=t.toLowerCase();
  if(s==="doodledog6767")
    return "https://www.youtube.com/watch?v=dQw4w9WgXcQ";
  let m=s.replace(/times/g,"*").replace(/x/g,"*");
  if(/[\d]/.test(m)){
    try{return String(Function("return "+m)());}catch{}
  }
  return "I understand";
}

/* MODES */
function showChat(){openProject(currentProject)}
function showImages(){messages.innerHTML="";images.forEach(i=>render(i,"ai"))}
function clearChat(){projects[currentProject]=[];messages.innerHTML="";save()}

/* PROFILE */
profilePic.onclick=()=>{
  const f=document.createElement("input");
  f.type="file";f.accept="image/*";
  f.onchange=e=>{
    const r=new FileReader();
    r.onload=()=>{
      profilePic.src=r.result;
      if(username){avatar=r.result;localStorage.setItem("avatar",r.result)}
      else{
        setTimeout(()=>{
          profilePic.style.transition="1.5s";
          profilePic.style.opacity="0";
          profilePic.style.transform="scale(.2)";
        },1000);
      }
    };
    r.readAsDataURL(e.target.files[0]);
  };
  f.click();
};
function openProfile(){profilePopup.style.display="block"}
function login(){
  username=usernameInput.value.trim();
  localStorage.setItem("username",username);
  closePopups();
}
function logout(){localStorage.clear();location.reload()}

/* POPUPS */
function openAdd(){addPopup.style.display="block"}
function confirmAdd(){closePopups()}
function openShare(){
  navigator.clipboard.writeText(location.href);
  sharePopup.style.display="block";
}
function closePopups(){
  document.querySelectorAll(".popup").forEach(p=>p.style.display="none");
}

/* VOICE */
function toggleVoice(){
  if(!recognition){
    recognition=new(window.SpeechRecognition||webkitSpeechRecognition)();
    recognition.continuous=true;
    recognition.onresult=e=>{
      input.value+=e.results[e.results.length-1][0].transcript+" ";
    };
  }
  voiceOn=!voiceOn;
  voiceOn?recognition.start():recognition.stop();
}

/* MOTHER BUTTON */
document.body.onclick=()=>{
  motherClicks++;
  if(motherClicks>=100){
    ring.style.display="block";
  }
};
</script>
</body>
</html>

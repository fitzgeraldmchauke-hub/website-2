<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ultimate Fun AI Chatbot</title>
<style>
body { font-family: system-ui,sans-serif; margin:0; display:flex; height:100vh; background:#111; color:white; overflow:hidden; }
#sidebar { width:220px; background:#1a1a1a; padding:10px; display:flex; flex-direction:column; align-items:center; }
#sidebar h2 { margin-top:0; font-size:18px; text-align:center; }
#sidebar button { margin:5px 0; padding:8px; border:none; border-radius:6px; background:#333; color:white; cursor:pointer; width:100%; }
#sidebar input { margin:5px 0; width:90%; }
#main { flex:1; display:flex; flex-direction:column; }
#chatbox { flex:1; display:flex; flex-direction:column; background:#0f0f0f; color:white; border-radius:12px; margin:10px; overflow:hidden; }
#messages { flex:1; padding:10px; overflow-y:auto; display:flex; flex-direction:column; gap:6px; }
.msg { white-space:pre-wrap; padding:8px 12px; border-radius:8px; max-width:85%; }
.user { background:#4ea1ff33; align-self:flex-end; color:#4ea1ff; }
.ai { background:#333; align-self:flex-start; color:#e5e5e5; }
.typing { font-size:18px; letter-spacing:4px; color:#aaa; font-weight:500; animation:pulse 1.4s infinite ease-in-out; }
@keyframes pulse { 0% { opacity:0.3 } 50% { opacity:1 } 100% { opacity:0.3 } }
pre { background:#222; padding:8px; border-radius:6px; overflow-x:auto; margin:0; }
img.generated { max-width:100%; border-radius:8px; margin-top:5px; }
#input-area { display:flex; gap:6px; padding:10px; background:#111; flex-shrink:0; }
#input-area textarea { flex:1; padding:8px; border-radius:6px; border:none; background:#222; color:white; resize:none; font-family:system-ui,sans-serif; font-size:14px; }
#input-area button { border-radius:6px; border:none; cursor:pointer; background:#333; color:white; padding:0 12px; font-size:16px; }
#sidebar-avatar { width:80px; height:80px; border-radius:50%; object-fit:cover; margin:10px 0; }
</style>
</head>
<body>

<div id="sidebar">
<img id="sidebar-avatar" src="https://via.placeholder.com/80">
<h2>AI Controls</h2>
<button id="voice-toggle">Voice ON</button>
<button id="clear-chat">Clear Chat</button>
<hr>
<button id="profile-btn">Profile</button>
<button id="logout-btn">Log Out</button>
<label for="avatar-input">Choose Avatar:</label>
<input type="file" id="avatar-input" accept="image/*">
<button id="set-password-btn">Set Password</button>
</div>

<div id="main">
<div id="chatbox">
<div id="messages"></div>
<div id="input-area">
<textarea id="input" placeholder="Ask me anything..." rows="2"></textarea>
<button onclick="send()">âž¤</button>
</div>
</div>
</div>

<script>
// ----------------- DOM Elements -----------------
let voiceEnabled = true;
const messagesDiv = document.getElementById("messages");
const input = document.getElementById("input");
const voiceButton = document.getElementById("voice-toggle");
const clearButton = document.getElementById("clear-chat");
const profileBtn = document.getElementById("profile-btn");
const logoutBtn = document.getElementById("logout-btn");
const avatarInput = document.getElementById("avatar-input");
const setPasswordBtn = document.getElementById("set-password-btn");
const sidebarAvatar = document.getElementById("sidebar-avatar");

// ----------------- User Profiles -----------------
let currentUser = localStorage.getItem("current_user");
let userData = JSON.parse(localStorage.getItem("users")) || {};

if(!currentUser){
  currentUser = prompt("Choose a username:");
  if(!currentUser) currentUser = "Guest";
  localStorage.setItem("current_user", currentUser);
}

if(!userData[currentUser]){
  userData[currentUser] = { chats: [], voice: {rate:1, pitch:1, voiceName:null}, avatar:null, password:null };
}

// Password prompt
if(userData[currentUser].password){
  let attempts=0;
  while(attempts<3){
    const pass = prompt("Enter password for "+currentUser);
    if(pass===userData[currentUser].password) break;
    attempts++;
    if(attempts>=3) { alert("Too many attempts! Logging out."); localStorage.removeItem("current_user"); location.reload(); }
  }
}

function saveUsers(){ localStorage.setItem("users", JSON.stringify(userData)); }

// Load avatar
function updateSidebarAvatar(){
  sidebarAvatar.src = userData[currentUser].avatar || "https://via.placeholder.com/80";
}
updateSidebarAvatar();

// ----------------- Buttons -----------------
voiceButton.onclick = () => { voiceEnabled = !voiceEnabled; voiceButton.innerText = `Voice ${voiceEnabled?"ON":"OFF"}`; };
clearButton.onclick = () => { messagesDiv.innerHTML=""; userData[currentUser].chats=[]; saveUsers(); };
profileBtn.onclick = () => { alert("Logged in as: "+currentUser); };
logoutBtn.onclick = () => { localStorage.removeItem("current_user"); location.reload(); };
avatarInput.addEventListener("change", e=>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = ()=>{ userData[currentUser].avatar = reader.result; saveUsers(); updateSidebarAvatar(); };
  reader.readAsDataURL(file);
});
setPasswordBtn.onclick = () => {
  const pass = prompt("Set a new password:");
  if(pass){ userData[currentUser].password = pass; saveUsers(); alert("Password set!"); }
};

// ----------------- Messages -----------------
function addMessage(text, cls){
  const div = document.createElement("div");
  div.className="msg "+cls;
  div.innerText = text;
  messagesDiv.appendChild(div);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
  userData[currentUser].chats.push({text, role:cls});
  saveUsers();
  if(cls==="ai") speak(text);
}

// Load previous chat
userData[currentUser].chats.forEach(msg=>addMessage(msg.text,msg.role));

// ----------------- Voice -----------------
function speak(text){
  if(!voiceEnabled) return;
  const utter = new SpeechSynthesisUtterance(text);
  const v = userData[currentUser].voice;
  utter.rate=v.rate; utter.pitch=v.pitch;
  if(v.voiceName){
    const voices = speechSynthesis.getVoices();
    const selected = voices.find(voice=>voice.name===v.voiceName);
    if(selected) utter.voice=selected;
  }
  speechSynthesis.speak(utter);
}
function setVoice(rate=1,pitch=1,voiceName=null){
  userData[currentUser].voice={rate,pitch,voiceName};
  saveUsers();
}

// ----------------- AI / Memory -----------------
let memory = JSON.parse(localStorage.getItem("ultimate_fun_ai")) || {
  facts: [
    {q:"1+1", a:"2"}, {q:"2+2", a:"4"}, {q:"capital of france", a:"Paris"}, {q:"water chemical formula", a:"H2O is water"},
    {q:"pythagoras theorem", a:"In a right-angled triangle: aÂ² + bÂ² = cÂ²"},
    {q:"photosynthesis", a:"Plants convert sunlight, CO2 and water into glucose and oxygen"},
    {q:"shakespeare", a:"William Shakespeare was an English playwright, poet, and actor"},
    {q:"newton first law", a:"An object remains at rest or in motion unless acted on by a force"},
    {q:"capital of italy", a:"Rome"}, {q:"quadratic formula", a:"x = (-b Â± âˆš(bÂ²-4ac)) / 2a"},
    {q:"mitosis", a:"Mitosis is the process by which a cell divides to form two identical cells"},
    {q:"world war 2 start", a:"1939"}, {q:"density formula", a:"Density = mass / volume"},
    {q:"integration", a:"Integration is the reverse of differentiation in calculus"},
    {q:"dna structure", a:"DNA is a double helix made of nucleotides"},
    {q:"relativity", a:"Einstein's theory: time and space are relative to the observer"}
  ]
};
function saveMemory(){ localStorage.setItem("ultimate_fun_ai", JSON.stringify(memory)); }
function lookupKnowledge(query){
  const qLower=query.toLowerCase().replace(/[^\w\s]/g,'');
  for(const f of memory.facts){
    const fact=f.q.toLowerCase().replace(/[^\w\s]/g,'');
    if(qLower.includes(fact)||fact.includes(qLower)) return f.a;
  }
  return null;
}
function learn(q,a){ memory.facts.push({q:q.toLowerCase(),a}); saveMemory(); }

// ----------------- Friendly AI -----------------
function makeFriendly(text){ text=text.trim(); if(text.length>0) text=text[0].toUpperCase()+text.slice(1); return text; }

// ----------------- OpenAI API -----------------
const API_KEY = "YOUR_API_KEY_HERE"; // Replace with your key
async function fetchFromGPT(query){
  const res = await fetch("https://api.openai.com/v1/chat/completions",{
    method:"POST",
    headers:{ "Content-Type":"application/json", "Authorization":"Bearer "+API_KEY },
    body: JSON.stringify({
      model:"gpt-5-mini",
      messages:[
        {role:"system", content:"You are a friendly AI assistant answering school questions. Keep replies positive, natural, human-like."},
        {role:"user", content:query}
      ]
    })
  });
  const data = await res.json();
  return data.choices[0].message.content.trim();
}

// ----------------- Main AI -----------------
async function localAnswer(query){
  const clean=query.toLowerCase().trim();
  if(["hi","hello","hey","yo","sup"].includes(clean)) return "Hi! ðŸ‘‹ What would you like to talk about?";
  const known=lookupKnowledge(query);
  if(known) return makeFriendly(known);
  try{
    const reply = await fetchFromGPT(query);
    learn(query,reply);
    return makeFriendly(reply);
  }catch(e){
    return "Thatâ€™s a good question. Can you explain a bit more?";
  }
}

// ----------------- Send -----------------
async function send(){
  const text=input.value.trim();
  if(!text) return;
  input.value="";
  addMessage(text,"user");
  const typing = document.createElement("div");
  typing.className="msg ai typing";
  typing.innerText="...";
  messagesDiv.appendChild(typing);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
  await new Promise(r=>setTimeout(r,3000));
  const reply = await localAnswer(text);
  typing.remove();
  addMessage(reply,"ai");
}

// Enter key
input.addEventListener("keydown", function(e){ if(e.key==="Enter" && !e.shiftKey){ e.preventDefault(); send(); } });

</script>

</body>
</html>
